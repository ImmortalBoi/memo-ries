<script setup>
import { useDatabaseList } from "vuefire";
import { getDatabase, ref as DBref } from "firebase/database";
import { store } from "../../store"

const user = store.user.uid

const data = getMemoData();
const options = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
};

function getMemoData() {
    const db = getDatabase();
    return useDatabaseList(DBref(db, "users/" + user + "/memo/"));
}

function trimString(string, length) {
    return string.length > length
        ? string.substring(0, length - 3) + "..."
        : string;
}
</script>

<template>
    <!-- Hero Start -->
    <div class="shadow-lg border-b border-primary flex flex-row justify-center py-3 bg-repeat bg-[url('@/assets/Hero.png')]"
        style="background-size: 1440">
        <router-link to="/newMemo">
            <div class="group flex flex-col items-center cursor-pointer">
                <svg width="457" height="321" viewBox="0 0 457 321" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="300" height="320.839" fill="#E1EFE1" fill-opacity="0.5" />
                    <g class="transition ease-in-out delay-20 group-hover:translate-x-5 fill-text group-hover:fill-accent">
                        <path
                            d="M294 141H152.732C146.688 134.492 127.019 117 90 117C52.9812 117 33.3116 134.492 27.2684 141H6C4.4087 141 2.88258 141.632 1.75736 142.757C0.632142 143.883 0 145.409 0 147V315C0 316.591 0.632142 318.117 1.75736 319.243C2.88258 320.368 4.4087 321 6 321H294C295.591 321 297.117 320.368 298.243 319.243C299.368 318.117 300 316.591 300 315V147C300 145.409 299.368 143.883 298.243 142.757C297.117 141.632 295.591 141 294 141ZM90 129C122.88 129 139.576 144.378 144 149.2V301.304C128.233 290.181 109.288 284.461 90 285C70.7118 284.461 51.7675 290.181 36 301.304V149.212C40.418 144.437 57.2432 129 90 129ZM134.084 309H45.9998C59.1709 300.768 74.4734 296.595 90 297C105.555 296.573 120.891 300.748 134.084 309ZM12 153H24V309H12V153ZM288 309H156V153H288V309Z" />
                        <path
                            d="M180 177H264C265.591 177 267.117 176.368 268.243 175.243C269.368 174.117 270 172.591 270 171C270 169.409 269.368 167.883 268.243 166.757C267.117 165.632 265.591 165 264 165H180C178.409 165 176.883 165.632 175.757 166.757C174.632 167.883 174 169.409 174 171C174 172.591 174.632 174.117 175.757 175.243C176.883 176.368 178.409 177 180 177Z" />
                        <path
                            d="M59.9212 159.179C60.6778 159.179 61.4268 159.029 62.1249 158.737C62.823 158.445 63.4561 158.018 63.9876 157.479C64.0433 157.436 69.8703 153 90.0003 153C109.386 153 115.506 157.113 115.984 157.456C117.146 158.502 118.67 159.053 120.232 158.992C121.795 158.931 123.271 158.262 124.348 157.128C125.424 155.994 126.016 154.485 125.996 152.922C125.976 151.358 125.347 149.864 124.242 148.758C122.948 147.463 115.207 141 90.0003 141C64.7933 141 57.053 147.463 55.7583 148.758C54.6146 149.89 53.9605 151.425 53.9364 153.034C53.9123 154.643 54.5201 156.197 55.6294 157.362C56.1899 157.933 56.8577 158.387 57.5942 158.699C58.3307 159.01 59.1215 159.173 59.9212 159.179Z" />
                        <path
                            d="M59.9212 189.179C60.6778 189.179 61.4268 189.029 62.1249 188.737C62.823 188.445 63.4561 188.018 63.9876 187.479C64.0433 187.436 69.8703 183 90.0003 183C109.386 183 115.506 187.113 115.984 187.456C117.146 188.502 118.67 189.053 120.232 188.992C121.795 188.931 123.271 188.262 124.348 187.128C125.424 185.994 126.016 184.485 125.996 182.922C125.976 181.358 125.347 179.864 124.242 178.758C122.948 177.463 115.207 171 90.0003 171C64.7933 171 57.053 177.463 55.7583 178.758C54.6146 179.89 53.9605 181.425 53.9364 183.034C53.9123 184.643 54.5201 186.197 55.6294 187.362C56.1899 187.933 56.8577 188.387 57.5942 188.699C58.3307 189.01 59.1215 189.173 59.9212 189.179Z" />
                        <path
                            d="M59.9212 219.179C60.6778 219.179 61.4268 219.029 62.1249 218.737C62.823 218.445 63.4561 218.018 63.9876 217.479C64.0433 217.436 69.8703 213 90.0003 213C109.386 213 115.506 217.113 115.984 217.456C117.146 218.502 118.67 219.053 120.232 218.992C121.795 218.931 123.271 218.262 124.348 217.128C125.424 215.994 126.016 214.485 125.996 212.922C125.976 211.358 125.347 209.864 124.242 208.758C122.948 207.463 115.207 201 90.0003 201C64.7933 201 57.053 207.463 55.7583 208.758C54.6146 209.89 53.9605 211.425 53.9364 213.034C53.9123 214.643 54.5201 216.197 55.6294 217.362C56.1899 217.933 56.8577 218.387 57.5942 218.699C58.3307 219.01 59.1215 219.173 59.9212 219.179Z" />
                        <path
                            d="M59.9212 249.179C60.6778 249.179 61.4268 249.029 62.1249 248.737C62.823 248.445 63.4561 248.018 63.9876 247.479C64.0433 247.436 69.8703 243 90.0003 243C109.386 243 115.506 247.113 115.984 247.456C117.146 248.502 118.67 249.053 120.232 248.992C121.795 248.93 123.271 248.262 124.348 247.128C125.424 245.994 126.016 244.485 125.996 242.922C125.976 241.358 125.347 239.864 124.242 238.758C122.948 237.463 115.207 231 90.0003 231C64.7933 231 57.053 237.463 55.7583 238.758C54.6146 239.89 53.9605 241.425 53.9364 243.034C53.9123 244.643 54.5201 246.197 55.6294 247.362C56.1899 247.933 56.8577 248.387 57.5942 248.699C58.3307 249.01 59.1215 249.173 59.9212 249.179Z" />
                        <path
                            d="M59.9212 279.179C60.6778 279.179 61.4268 279.029 62.1249 278.737C62.823 278.445 63.4561 278.018 63.9876 277.479C64.0433 277.436 69.8703 273 90.0003 273C109.386 273 115.506 277.113 115.984 277.456C117.146 278.502 118.67 279.053 120.232 278.992C121.795 278.93 123.271 278.262 124.348 277.128C125.424 275.994 126.016 274.485 125.996 272.922C125.976 271.358 125.347 269.864 124.242 268.758C122.948 267.463 115.207 261 90.0003 261C64.7933 261 57.053 267.463 55.7583 268.758C54.6146 269.89 53.9605 271.425 53.9364 273.034C53.9123 274.643 54.5201 276.197 55.6294 277.362C56.1899 277.933 56.8577 278.387 57.5942 278.699C58.3307 279.01 59.1215 279.173 59.9212 279.179Z" />
                        <path
                            d="M180 207H264C265.591 207 267.117 206.368 268.243 205.243C269.368 204.117 270 202.591 270 201C270 199.409 269.368 197.883 268.243 196.757C267.117 195.632 265.591 195 264 195H180C178.409 195 176.883 195.632 175.757 196.757C174.632 197.883 174 199.409 174 201C174 202.591 174.632 204.117 175.757 205.243C176.883 206.368 178.409 207 180 207Z" />
                        <path
                            d="M180 237H264C265.591 237 267.117 236.368 268.243 235.243C269.368 234.117 270 232.591 270 231C270 229.409 269.368 227.883 268.243 226.757C267.117 225.632 265.591 225 264 225H180C178.409 225 176.883 225.632 175.757 226.757C174.632 227.883 174 229.409 174 231C174 232.591 174.632 234.117 175.757 235.243C176.883 236.368 178.409 237 180 237Z" />
                        <path
                            d="M180 267H264C265.591 267 267.117 266.368 268.243 265.243C269.368 264.117 270 262.591 270 261C270 259.409 269.368 257.883 268.243 256.757C267.117 255.632 265.591 255 264 255H180C178.409 255 176.883 255.632 175.757 256.757C174.632 257.883 174 259.409 174 261C174 262.591 174.632 264.117 175.757 265.243C176.883 266.368 178.409 267 180 267Z" />
                        <path
                            d="M180 297H264C265.591 297 267.117 296.368 268.243 295.243C269.368 294.117 270 292.591 270 291C270 289.409 269.368 287.883 268.243 286.757C267.117 285.632 265.591 285 264 285H180C178.409 285 176.883 285.632 175.757 286.757C174.632 287.883 174 289.409 174 291C174 292.591 174.632 294.117 175.757 295.243C176.883 296.368 178.409 297 180 297Z" />
                    </g>
                    <g class="transition ease-in-out fill-text delay-20 group-hover:fill-accent group-hover:-translate-x-5">
                        <path
                            d="M413.258 26.4932L399.078 40.6728L437.164 78.7588L451.344 64.5791C458.668 57.2549 458.668 45.3896 451.344 38.0654L439.801 26.4932C432.476 19.1689 420.611 19.1689 413.287 26.4932H413.258ZM392.457 47.2939L324.166 115.614C321.119 118.661 318.893 122.44 317.662 126.571L307.291 161.815C306.559 164.306 307.232 166.972 309.049 168.788C310.865 170.604 313.531 171.278 315.992 170.575L351.236 160.204C355.367 158.974 359.146 156.747 362.193 153.7L430.543 85.3799L392.457 47.2939Z" />
                    </g>
                </svg>

                <div
                    class="m-4 px-1 text-text font-jomhuria font-medium text-6xl group-hover:shadow-lg group-hover:text-secondary group-hover:bg-accent transition ease-in-out delay-20 text-center">
                    Add A New Memo To Your List
                </div>
            </div>
        </router-link>
    </div>
    <!-- Hero End -->

    <div class="flex flex-col items-center p-5 min-h-screen bg-background font-jomhuria">
        <!-- <div class="self-start">
            <p class="pl-2 text-text font-semibold text-xl ">All Memos</p>
        </div> -->

        <div class="py-1 w-full" v-for="(DataEntry, index) in data" :key="index">
            <router-link :to="'/memos/' + DataEntry.id"
                class="relative block p-6 bg-secondary border border-primary rounded-lg shadow hover:bg-background">
                <h5 class=" text-4xl font-semibold tracking-tight">
                    {{ DataEntry.title }}
                </h5>
                <hr class="h-px  w-3/5 mx-auto bg-accent border-0" />
                <p class=" font-normal text-text text-3xl">
                    {{ trimString(DataEntry.message, 100) }}
                </p>
                <div class="absolute top-1 right-1 text-3xl text-text">
                    {{
                        new Date(DataEntry.time).toLocaleString(
                            "en-US",
                            options
                        )
                    }}
                </div>
            </router-link>
        </div>
    </div>
</template>
